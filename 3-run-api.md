# 3. วิธีใช้ PM2 รัน Server 

PM2 เป็นเครื่องมือเฉพาะ ที่เราสามารถใช้ฟีเจอร์ในการรัน server และให้มันเฝ้ามอง (watch) การเปลี่ยนแปลงได้ 

_อ้างอิง - [PM2: Auto restart app on file change](http://pm2.keymetrics.io/docs/usage/watch-and-restart/#auto-restart-apps-on-file-change)_

## 1. รันไฟล์ server แบบเฝ้ามอง (watch)

เราสามารถใช้คำสั่ง `pm2 start <...> --watch` เพื่อให้ตรวจจับการเปลี่ยนแปลงในโค้ด และ restart ตัวเอง

```bash
pm2 start index.js --watch
```

ถ้ารันสำเร็จ จะมีรายการประมาณนี้ แสดงขึ้นมาใน terminal 

```bash
┌──────────┬────┬─────────┬──────┬───────┬────────┬─────────┬────────┬─────┬───────────┬─────────────────────────┬──────────┐
│ App name │ id │ version │ mode │ pid   │ status │ restart │ uptime │ cpu │ mem       │ user                    │ watching │
├──────────┼────┼─────────┼──────┼───────┼────────┼─────────┼────────┼─────┼───────────┼─────────────────────────┼──────────┤
│ index    │ 0  │ 1.0.0   │ fork │ 70986 │ online │ 0       │ 0s     │ 0%  │ 11.1 MB   │ teerasejjiraphatchandej │ enabled  │
└──────────┴────┴─────────┴──────┴───────┴────────┴─────────┴────────┴─────┴───────────┴─────────────────────────┴──────────┘
```

## 2. วิธีปิด server 

ให้ใช้คำสั่ง `pm2 stop <id> --watch` โดยระบุ id ของ App name เช่น ในที่นี้ของเราเป็น `0` ก็ให้รันเป็น 

```bash
pm2 stop 0 --watch
```